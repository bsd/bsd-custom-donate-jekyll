(function(e,t){window._gaq=window._gaq||[];window.optimizely=window.optimizely||[];var n=function(e){e=e.replace(/(\[|\])/g,"\\$1");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(window.location.href);return n===null?"":n[1]},r=function(e,t){window._gaq.push(["_trackEvent"].concat(e));window.optimizely.push(["trackEvent"].concat(t))},i={},s=window.location.hash.replace("#",""),o=window.location.protocol.indexOf("s")===-1,u=n("nomin")==="1",a="ontouchstart"in window||"msmaxtouchpoints"in window.navigator;String.prototype.commafy=function(){return this.replace(/(^|[^\w.])(\d{4,})/g,function(e,t,n){return t+n.replace(/\d(?=(?:\d\d\d)+(?!\d))/g,"$&,")})};Number.prototype.commafy=function(){return String(this).commafy()};if(o){console.log("WARNING: nonsecure domain = test mode.");e("body").prepend('<div class="insecure-warning">non-secure domain, using test mode.</div>')}e.wait=function(t){return e.Deferred(function(e){setTimeout(e.resolve,t)})};e.Topic=function(t){var n,r=t&&i[t];if(!r){n=e.Callbacks();r={publish:n.fire,subscribe:n.add,unsubscribe:n.remove};t&&(i[t]=r)}return r};var f={};(function(e){"use strict";e.fn.serializeObject=function(){var t={},n=this.serializeArray();e.each(n,function(){if(t[this.name]!==undefined){t[this.name].push||(t[this.name]=[t[this.name]]);t[this.name].push(this.value||"")}else t[this.name]=this.value||""});return t};e.fn.extend({blueContribute:function(t){var i=e(this),s=e("body"),u=!1,a=i.find('[name="source_codes"]'),l=a.val(),c=i.find(".bsdcd-general_error"),h=n("source")||n("fb_ref"),p=n("subsource"),d=i.find("[name='slug']"),v=document.title,m=!1,g={unknown:"We were unable to process your transaction at this time.",invalid:"Your donation was not successful. Please correct the problems marked below.",declined:"The transaction was declined. Please check that the address information is correct or else use a different card."},y,b,w,E,S,x;if(h||p){p&&(h=h?h+","+p:p);a.val(l?l+","+h:h)}y=function(e){f.settings.debug&&typeof console=="object"&&window.console.log(e)};E=function(){return!0};S=function(t){var n=1,r=["Processing",".Processing.","..Processing..","...Processing..."],i=r.length;m=t;if(t){s.addClass("blue_contribute_processing");(function o(){e.wait(400).then(function(){document.title=r[n%i]+" | "+v;if(m){n++;o()}else document.title=v})})()}else s.removeClass("blue_contribute_processing")};x=function(e){c.text(e).removeClass("hidden")};b=function(t){var a=!1,l,h;if(f.latestResponseObject){y("removing previous errors");y(f.latestResponseObject.field_errors);if(e.isArray(f.latestResponseObject.field_errors)){if(f.latestResponseObject.field_errors.length>0)for(l=0;l<=f.latestResponseObject.field_errors.length-1;l++){y("reseting "+f.latestResponseObject.field_errors[l].field);i.find("."+f.latestResponseObject.field_errors[l].field+"_error").text("").addClass("hidden");i.find("."+f.latestResponseObject.field_errors[l].field+"_related").removeClass("bsdcd-error");c.text("").addClass("hidden");s.removeClass("blue_contribute_error")}}else y("no field errors on the latest repsonse object")}else y("this is the first submission");var p=!1;if(t&&!t.api_version)try{f.latestResponseObject=jQuery.parseJSON(t.responseText)||t;p=!0}catch(d){p=!1;y("api response body invalid")}else{f.latestResponseObject=t;p=!0}h=f.latestResponseObject;if(p===!0&&h)if(h.status==="success"||h.status==="paypal"){if(typeof f.settings.customSuccess=="function"){S(!1);f.settings.customSuccess(h)}else if(!n("debug")||!o)window.location=h.redirect_url}else{y("response was not a success status code");if(h.code==="noslug"||h.code==="invalidslug")x(g.unknown+" [No slug]");else if(h.code==="validation"){y("validation error");r(["Donate API","Validation Errors",f.latestResponseObject.field_errors.length],"donate_api_valiation_error");if(h.field_errors&&e.isArray(h.field_errors)&&h.field_errors.length>0){y(h.field_errors);h.field_errors.length===1&&h.field_errors[0].field==="amount_group"&&(a=!0);for(l=0;l<=h.field_errors.length-1;l++){i.find("."+h.field_errors[l].field+"_error").text(h.field_errors[l].message).removeClass("hidden");i.find("."+h.field_errors[l].field+"_related").addClass("bsdcd-error").removeClass("hidden")}x(g.invalid)}else{y("invalid field_errors property in the donate api");x(g.unknown+" [Invalid Validaiton Repsonse]")}}else if(h.code==="gateway"){y("gateway rejected the transaction");if(h.gateway_response&&h.gateway_response.status==="decline"){x(g.declined);y("bank declined");r(["Donate API","Gateway Error",h.gateway_response.status],"donate_api_gateway_error")}else{x(g.unknown+" [Gateway]");y("unknown error gateway error");r(["Donate API","Unknown Gateway Error","unknown or malformed"],"donate_api_gateway_error")}}else{x(g.unknown+" [Code: "+(h.code?h.code:"unknown")+"]");y("truly unknown error from donate api");r(["Donate API","Unknown Error",h.code?h.code:"unknown"],"donate_api_gateway_error")}s.addClass("blue_contribute_error");S(!1);u=!1;e.Topic&&e.Topic("bsd-validation-update").publish(!1,a);window.scrollTo(0,0)}else{u=!1;s.addClass("blue_contribute_error");S(!1);e.Topic&&e.Topic("bsd-validation-update").publish(!1,a);y("donate api response not parsable");x(g.unknown+" [API DOWN]")}typeof f.settings.afterPost=="function"&&f.settings.afterPost()};w={debug:!1,postTo:"/page/cde/Api/Charge/v1",beforePost:E,responseHandler:b,customSuccess:null,postdelay:0,slug:i.data("slug")||"default",recurSlug:i.data("recur-slug")||!1};f.settings=e.extend(!0,w,t);f.settings.recurSlug?i.on("click","[name='recurring_acknowledge']",function(e){d.val()===f.settings.slug?d.val(f.settings.recurSlug):d.val(f.settings.slug)}):i.find("[name='recurring_acknowledge']").closest("li").remove();f.submitForm=function(){y("form submit attempt");var t=!0,n;typeof f.settings.beforePost=="function"&&(t=f.settings.beforePost());if(t&&!u){u=!0;S(!0);e.wait(f.settings.postdelay).then(function(){n=e.ajax({url:f.settings.postTo,type:o?"GET":"POST",dataType:"json",converters:{"text json":jQuery.parseJSON},timeout:3e4,data:i.serializeObject()}).always(b);o&&console.log("non-secure domain, transaction results simulated")})}else y("double submission detected")};i.submit(function(e){f.submitForm();e.preventDefault()});typeof f.settings.afterInit=="function"&&f.settings.afterInit();return this}})})(jQuery);(function(e){function x(t){if(!t||typeof t!="string")return!1;var n=t.split("x"),r=0;n&&n.length&&e.each(n,function(e,t){var n=parseFloat(t);console.log(n,b,n>b);if(n&&i.eq(r).length&&n>=b&&n<=w){i.eq(r).html(E+n.commafy());s.eq(r).val(n);r++}})}function T(e){var t=f.val(),n=l.hide().find(".state_cd");if(t==="US"){if(!n.is("select")){n.remove();l.append(m.val(""))}r.removeClass("state-text-input");c.html("State<span>*</span>");v.html("ZIP<span>*</span>");y="US"}else{if(n.is("select")){n.remove();l.append(g.val(""))}r.addClass("state-text-input");c.html(t==="GB"?"County<span>*</span>":"State/Region/Province<span>*</span>");v.html("Postal Code<span>*</span>");y=t==="GB"?"GB":"INT"}l.show()}var t=e("body"),r=t.find("form"),i=r.find(".preset_amount_label"),s=r.find(".preset_amount_input"),o=r.find(".amount_other"),a=r.find(".other_amount_radio"),f=r.find(".country"),l=r.find(".state_cd_cont").eq(0),c=l.find("label"),h=l.find("input,select").eq(0),p=h.attr("id"),d=h.attr("tabindex"),v=r.find("label.zip_related"),m=t.find(".us-state-dropdown").eq(0).clone().val("").addClass("state_cd").removeClass("hidden").attr("name","state_cd").attr("id",p).attr("tabindex",d),g=e("<input/>",{type:"text",name:"state_cd",id:p,"class":"text state_cd",tabindex:d}),y=r.data("default-country"),b=parseFloat(r.data("min-donation"))||0,w=parseFloat(r.data("max-donation"))||Infinity,E=e("body").find("[data-currency-symbol]").data("currency-symbol")||"$",S=n("amounts");e(".other_amount_label").hide();r.find('[name="http_referrer"]').val(document.referrer);if(u){e("<input/>",{type:"hidden",name:"nomin",value:"1"}).appendTo(r);b=.01}console.log(b,w);x(S);r.find(".honoree-select").on("change",function(){var t=e(this),n=t.val();r.removeClass("honor-section memorial-section");n==="1"?r.addClass("honor-section memorial-section"):n==="0"&&r.addClass("honor-section")});r.on("click",".preset_amount_label",function(t){var n=e(this);i.removeClass("active");n.addClass("active");o.val("");n.prev().prop("checked",!0)}).on("keydown",".amount_other",function(){i.removeClass("active");s.each(function(){e(this).prop("checked",!1)});a.prop("checked",!0)}).one("keydown",".amount_other",function(){t.removeClass("pre-first-click")}).one("click",".preset_amount_label",function(){t.removeClass("pre-first-click");e.Topic("change-step").publish(1)});f.on("change",function(){T()})})(jQuery)})(jQuery,window);