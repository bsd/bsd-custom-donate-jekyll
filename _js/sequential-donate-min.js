(function(e,t){var n=function(e){e=e.replace(/(\[|\])/g,"\\$1");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(window.location.href);return n===null?"":n[1]},r={};e.Topic=function(t){var n,i=t&&r[t];if(!i){n=e.Callbacks();i={publish:n.fire,subscribe:n.add,unsubscribe:n.remove};t&&(r[t]=i)}return i};var i=i||{};(function(e){"use strict";e.fn.extend({quickDonate:function(t){var n=e("body"),r=n.find("#bsd_contribute_form").eq(0),s,o,u,a,f,l,c,h;i.settings=i.settings||{};l=["[name='bsd_form_quick_donate_populated']","[name='cc_number']","[name='cc_type_cd']","[name='cc_type_cd']","[name='cc_expir_month']","[name='cc_expir_year']","[name='firstname']","[name='lastname']","[name='addr1']","[name='addr2']","[name='country']","[name='city']","[name='state_cd']","[name='zip']","[name='email']","[name='phone']","[name='employer']","[name='occupation']","[name='quick_donate_populated']"];c=function(t){if(i.tokenRequest.status===200){i.responseJSON=e.parseJSON(i.tokenRequest.responseText);u=t;if(typeof u.enabled=="boolean"&&typeof u.token=="string"&&typeof u.token_info=="object"&&typeof u.token_info.account_last_four=="string"&&typeof u.token_info.cc_type_cd=="string"&&typeof u.token_info.cc_expir_month=="string"&&typeof u.token_info.cc_expir_year=="string"&&typeof u.token_info.firstname=="string"&&typeof u.token_info.lastname=="string"&&typeof u.token_info.addr1=="string"&&typeof u.token_info.addr2=="string"&&typeof u.token_info.city=="string"&&typeof u.token_info.state_cd=="string"&&typeof u.token_info.zip=="string"&&typeof u.token_info.country=="string"&&typeof u.token_info.email=="string"&&typeof u.token_info.phone=="string"&&typeof u.token_info.employer=="string"&&typeof u.token_info.occupation=="string"){i.settings.debug===!0&&console.log("properties in response object are all the correct type");if(u.enabled){r.find("[name='quick_donate_populated']").val(u.token);u.token_info.cc_type_cd==="ax"?e("[name='cc_number']").val("XXXXXXXXXXX"+u.token_info.account_last_four):e("[name='cc_number']").val("XXXXXXXXXXXX"+u.token_info.account_last_four);r.find("[value='"+u.token_info.cc_type_cd+"']").prop("checked",!0);u.token_info.cc_expir_month.length===1?r.find("[name='cc_expir_month']").val("0"+u.token_info.cc_expir_month):r.find("[name='cc_expir_month']").val(u.token_info.cc_expir_month);r.find("[name='cc_expir_year']").val(u.token_info.cc_expir_year);r.find("[name='firstname']").val(u.token_info.firstname);r.find("[name='lastname']").val(u.token_info.lastname);r.find("[name='addr1']").val(u.token_info.addr1);r.find("[name='addr2']").val(u.token_info.addr2);r.find("[name='city']").val(u.token_info.city);r.find("[name='zip']").val(u.token_info.zip);r.find("[name='country']").val(u.token_info.country).change();r.find("[name='email']").val(u.token_info.email);r.find("[name='phone']").val(u.token_info.phone);r.find("[name='employer']").val(u.token_info.employer);r.find("[name=occupation]").val(u.token_info.occupation);r.find("[name='state_cd']").val(u.token_info.state_cd);r.find("[name='quick_donate_populated']").val(u.token);e(i.settings.nameElement).text(u.token_info.firstname+" "+u.token_info.lastname);e(i.settings.addrElement).text(u.token_info.addr1+" "+u.token_info.addr2);e(i.settings.locElement).text(u.token_info.city+" "+u.token_info.state_cd+" "+u.token_info.zip+" "+u.token_info.country);i.cvvHolder=r.removeClass("cvv-input").find("#cc_cvv_cont").detach();u.token_info.cc_type_cd==="vs"?a="Visa":u.token_info.cc_type_cd==="mc"?a="MasterCard":u.token_info.cc_type_cd==="ax"?a="American Express":u.token_info.cc_type_cd==="dc"&&(a="DiscoverCard");e(i.settings.ccTypeElement).text(a);u.token_info.cc_type_cd==="ax"?f="**** ****** *"+u.token_info.account_last_four:f="**** **** **** "+u.token_info.account_last_four;e(i.settings.ccNumberElement).text(f);n.addClass("qd_populated").removeClass("qd_loading");if(e.Topic){e.Topic("data-update").publish("qd_populated");e.Topic("qd-status").publish(!0)}}else{n.removeClass("qd_loading");e.Topic&&e.Topic("qd-status").publish(!1)}}else{i.settings.debug===!0&&console.log("properties in response object are not the correct type");n.removeClass("qd_loading");e.Topic&&e.Topic("qd-status").publish(!1)}}else{n.removeClass("qd_loading");i.settings.debug===!0&&console.log("something was wrong with the response object",t,i.tokenRequest);e.Topic&&e.Topic("qd-status").publish(!1)}typeof i.settings.callback=="function"&&i.settings.callback()};h=function(t,s){typeof t=="object"&&t.preventDefault();n.removeClass("qd_populated");e.Topic&&e.Topic("qd-status").publish(!1);if(s==="nuclear"){var o=e.getJSON("/page/user/logout?jsonp=callback=?");o.always(function(e){window.location=window.location})}else{i.cvvHolder&&i.cvvHolder.length&&r.addClass("cvv-input").find("#cc_expiration_cont").after(i.cvvHolder);e.Topic&&e.Topic("data-update").publish("qd_cleared")}};s={tokenRequestPath:"/ctl/Contribution/Quick/GetToken",nuclearElement:"#qd_nuclear",differentInfoElement:"#qd_clear_info",nameElement:"#qd_name",addrElement:"#qd_address",locElement:"#qd_location",ccTypeElement:"#qd_cc_type",ccNumberElement:"#qd_cc_number",clearInfo:h,responseHandler:c};i.settings=e.extend(!0,s,t);n.addClass("qd_loading");i.tokenRequest=e.ajax({url:i.settings.tokenRequestPath,type:"GET",dataType:"json"});i.tokenRequest.always(i.settings.responseHandler);e(i.settings.nuclearElement).click(function(e){i.settings.clearInfo(e,"nuclear")});e(i.settings.differentInfoElement).click(function(e){i.settings.clearInfo(e,"reveal")});e("#BSD-quick_donate_login_link-a").click(function(e){e.preventDefault();window.open("/ctl/Contribution/Quick/Login","quickDonateLogin","status=0,toolbar=0,location=0,menubar=0,resizable=0,scrollbars=0,width=550,height=350")});e("#BSD-quick_donate_logout").click(function(t){t.preventDefault();e.ajax({url:"/ctl/Spud/Remove"});e.ajax({url:"/page/user/logout",dataType:"jsonp",jsonp:"jsonp",success:function(e,n,r){i.settings.clearInfo(t,"reveal")}});e("#BSD-quick_donate_info").hide()});e.Topic("validation-update").subscribe(function(e,t){!e&&!t&&i.settings.clearInfo(0,"reveal")})}})})(jQuery);(function(e){e.fn.extend({detectCCType:function(t){function d(){var e=a.val(),t=[];if(!p.test(e)){u.removeAttr("checked");n.removeClass("cc-is-vs cc-is-ax cc-is-ds cc-is-mc cc-is-qd");f.test(e)?t=r:l.test(e)?t=i:c.test(e)?t=s:h.test(e)&&(t=o);if(t.length){t.attr("checked","checked");n.addClass("cc-is-"+t.val())}}else n.addClass("cc-is-qd")}var n=t||e(".bsd-creditCardTypeSelector")||e("form"),r=n.find("[name='cc_type_cd'][value='vs']"),i=n.find("[name='cc_type_cd'][value='ax']"),s=n.find("[name='cc_type_cd'][value='ds']"),o=n.find("[name='cc_type_cd'][value='mc']"),u=r.add(i).add(s).add(o),a=n.closest("form").find("#cc_number"),f=/^4/,l=/^3/,c=/^6/,h=/^5/,p=/^x/i;e.Topic&&e.Topic("data-update").subscribe(d);a.keyup(d).change(d).bind("paste",d);e("[data-ccdetection]").length>0?e(e("[data-ccdetection]").val()).addClass("cc-type-detection-active"):e("#cc-type-cont").addClass("cc-type-detection-active")}})})(jQuery);var s={};(function(e){"use strict";e.fn.serializeObject=function(){var t={},n=this.serializeArray();e.each(n,function(){if(t[this.name]!==undefined){t[this.name].push||(t[this.name]=[t[this.name]]);t[this.name].push(this.value||"")}else t[this.name]=this.value||""});return t};e.fn.extend({blueContribute:function(t){var r=e(this),i=e("body"),o=!1,u,a,f,l,c;u=function(e){s.settings.debug&&(typeof console=="object"?window.console.log(e):window.alert(e))};l=function(){i.addClass("blue_contribute_processing");return!0};c=function(){i.on("click","[name='recurring_acknowledge']",function(t){var n,r,i,o;n=e(this);o=e("[name='slug']");o.val()===s.settings.slug?o.val(s.settings.recurSlug):o.val(s.settings.slug)})};a=function(t){var r=!1,a;i.toggleClass("blue_contribute_processing");if(s.latestResponseObject){u("removing previous errors");u(s.latestResponseObject.field_errors);if(e.isArray(s.latestResponseObject.field_errors)){if(s.latestResponseObject.field_errors.length>0)for(a=0;a<=s.latestResponseObject.field_errors.length-1;a++){u("reseting "+s.latestResponseObject.field_errors[a].field);e("."+s.latestResponseObject.field_errors[a].field+"_error").text("").removeClass("hidden");e("."+s.latestResponseObject.field_errors[a].field+"_related").removeClass("error");e(".general_error").text("").removeClass("hidden");e("body").toggleClass("blue_contribute_error")}}else u("there were no field errors on the latest repsonse object")}else u("the previous response object does not exist. this is the first submission");var f=!1;try{s.latestResponseObject=jQuery.parseJSON(t.responseText)||t;f=!0}catch(l){f=!1;u("the response body from the api could not be parsed as json by jquery")}if(f===!0)if(s.latestResponseObject.status==="success")n("debug")||(window.location=s.latestResponseObject.redirect_url);else{u("response was not a success status code");o=!1;if(s.latestResponseObject.code==="noslug")window.alert("A BSD slug must be provided as a value in a hidden field named 'slug' on this form.");else if(s.latestResponseObject.code==="validation"){u("validation error");if(e.isArray(s.latestResponseObject.field_errors))if(s.latestResponseObject.field_errors.length>0){u(s.latestResponseObject.field_errors);s.latestResponseObject.field_errors.length===1&&s.latestResponseObject.field_errors[0].field==="amount_group"&&(r=!0);for(a=0;a<=s.latestResponseObject.field_errors.length-1;a++){e("."+s.latestResponseObject.field_errors[a].field+"_error").text(s.latestResponseObject.field_errors[a].message).removeClass("hidden");e("."+s.latestResponseObject.field_errors[a].field+"_related").addClass("error").removeClass("hidden");e(".general_error").text("Your donation was not successful. Please correct the problems marked below.").removeClass("hidden")}}else u("the field_errors property in the donate api response is an array, but has no items");else u("the field_errors property in the donate api response is not an array")}else if(s.latestResponseObject.code==="gateway"){u("donate api response indicates that the gateway rejected the transaction");if(s.latestResponseObject.gateway_response.status==="decline"){e(".general_error").text("The transaction was declined. Please check that the address matches or else use a different credit card.").removeClass("hidden");u("donate api response indicates that the gateway rejected the transaction because the bank declined the transaction")}else if(s.latestResponseObject.gateway_response.status==="unkown"||s.latestResponseObject.gateway_response.status==="error"){e(".general_error").text("There was a problem with your submission. Please try again.").removeClass("hidden");u("unknown error received from the donate api")}else{e(".general_error").text("There was a problem with your submission. Please try again.").removeClass("hidden");u("unknown error received from the donate api")}}i.addClass("blue_contribute_error");e.Topic&&e.Topic("validation-update").publish(!1,r);window.scrollTo(0,0)}else{u("donate api response was not parsable by jquery/is not valid json--it is probably html");e(".general_error").text("We are unable to process your transaction at this time.").removeClass("hidden")}typeof s.settings.afterPost=="function"&&s.settings.afterPost()};f={debug:!1,postTo:"/page/cde/Api/Charge/v1",beforePost:l,responseHandler:a,slug:"donate"};s.settings=e.extend(!0,f,t);c();s.submitForm=function(){u("form submit attempt");var t=!0;typeof s.settings.beforePost=="function"&&(t=s.settings.beforePost());if(t&&!o){o=!0;var n=e.ajax({url:s.settings.postTo,type:"POST",dataType:"json",data:e(r).serializeObject()});n.always(a)}else u("double submission detected")};r.submit(function(e){s.submitForm();e.preventDefault()});typeof s.settings.afterInit=="function"&&s.settings.afterInit()}})})(jQuery);var o={},u=u||[];o.bodyNode=e("body");window.optimizely=window.optimizely||[];(function(e){"use strict";e.fn.extend({sequential:function(t){o.currentStep=0;o.currency_symbol=o.bodyNode.find("[data-currency-symbol]").data("data-currency-symbol")||"$";var n="US";o.qd=!1;e.Topic&&e.Topic("qd-status").subscribe(function(e){o.qd=e;console.log("qd",e)});o.utilityFunctions={};o.utilityFunctions.postErrorHandler=function(){o.bodyNode.removeClass("sequential")};o.utilityFunctions.goToStep=function(t){var n,r;n=t<o.currentStep;r=function(){console.log("step",t);o.bodyNode.removeClass("sequential_step_"+o.currentStep);e(o.settings.stepContainers[o.currentStep]).addClass("inactive").removeClass("active");e("li.sequential_breadcrumb_"+o.currentStep).removeClass("active").addClass("completed");o.currentStep=t;o.bodyNode.addClass("sequential_step_"+o.currentStep);e(".sequential_error_message").text("");e(o.settings.stepContainers[o.currentStep]).addClass("active").removeClass("inactive");e("li.sequential_breadcrumb_"+o.currentStep).addClass("active");u.push(["_trackEvent","Sequential donate","Screen view",t]);window.optimizely.push(["trackEvent","sequential_screen_"+t]);t===1&&o.qd&&o.utilityFunctions.goToStep(2)};if(typeof t=="number"&&typeof o.settings.validationFunctions[o.currentStep]=="function")if(n)r();else if(o.currentStep!==t){var i=o.settings.validationFunctions[o.currentStep]();i&&r()}};e.Topic("first-click").subscribe(o.utilityFunctions.goToStep);o.utilityFunctions.validateAmounts=function(){var t,n,r,i,s,a;o.bodyNode.removeClass("sequential_error");e(".sequential_error_message").text("");t=parseFloat(e("input[name='amount']:checked").val());n=parseFloat(e('[name="amount_other"]').val().replace(/\,/g,""));r=function(){if(n){a=n;return!0}if(t){a=t;return!0}return!1};i=function(e){if(typeof o.settings.donationAmountLimit=="number"){if(typeof e=="number"){if(e<=o.settings.donationAmountLimit)return!0;u.push(["_trackEvent","Sequential donate","Amount error","Above maximum"]);window.optimizely.push(["trackEvent","sequential_amount_over_maximum_error"]);return!1}return!0}return!0};s=function(e){return typeof o.settings.donationAmountMinimum=="number"?typeof e=="number"?e>=o.settings.donationAmountMinimum?!0:!1:!0:!0};if(r()){if(i(a)){if(s(a)){e("#sequential_donate_btn_copy").text("Donate "+o.currency_symbol+a);return!0}o.bodyNode.addClass("sequential_error");e(".sequential_error_message").text("The minimum amount is "+o.currency_symbol+o.settings.donationAmountMinimum+".");return!1}o.bodyNode.addClass("sequential_error");e(".sequential_error_message").text("The maximum amount is "+o.currency_symbol+o.settings.donationAmountLimit+".");return!1}o.bodyNode.addClass("sequential_error");e(".sequential_error_message").text("Please select an amount.");return!1};o.utilityFunctions.validatePersonalInfo=function(){var t,r,i,s,u,a,f,l,c,h;t=0;o.bodyNode.removeClass("sequential_error");e(".sequential_error_message").text("");r=e("[name='firstname']");if(!r.val()){t++;r.addClass("error")}else r.removeClass("error");i=e("[name='lastname']");if(!i.val()){t++;i.addClass("error")}else i.removeClass("error");s=e("[name='addr1']");if(!s.val()){t++;s.addClass("error")}else s.removeClass("error");u=e("[name='city']");if(!u.val()){t++;u.addClass("error")}else u.removeClass("error");a=e("[name='state_cd']");if(a.is("select")&&a.val().length!==2||!a.val()){t++;a.addClass("error")}else a.removeClass("error");f=e("[name='zip']").val();n==="US"&&f.replace(/\D/g,"");if(n==="US"&&f.length>=5&&f.length<=9)o.bodyNode.find("[name='zip']").removeClass("error");else if(n==="GB"&&f.length>=3&&f.length<=10)o.bodyNode.find("[name='zip']").removeClass("error");else if(n==="US"||n==="GB"||!f){t++;o.bodyNode.find("[name='zip']").addClass("error")}else o.bodyNode.find("[name='zip']").removeClass("error");h=o.bodyNode.find("#country");if(o.settings.requireCountry&&!h.val()){t++;h.addClass("error")}l={};l.input=o.bodyNode.find("[name='email']");l.address=l.input.val();l.isValid=function(){var e=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return e.test(l.address)?!0:!1};if(l.isValid())l.input.removeClass("error");else{t++;l.input.addClass("error")}c={};c.input=o.bodyNode.find("[name='phone']");c.number=c.input.val();c.isValid=function(){var e=c.number.replace(/\D/g,"");return e.length>=10&&e.length<=11?!0:!1};if(c.isValid())c.input.removeClass("error");else{t++;c.input.addClass("error")}if(t>0){o.bodyNode.addClass("sequential_error");o.bodyNode.find(".sequential_error_message").text("Please correct the problems shown above.");return!1}return!0};o.utilityFunctions.validatePaymentInfo=function(){var t,n,r;r=0;t={};t.field=e("[name='cc_number']");t.number=t.field.val();t.isValid=function(){var e=/[0-9]{13,19}|([0-9- ]{3,8}){3,6}/;return e.test(t.number)||o.qd&&t.number.indexOf("XXX")>-1?!0:!1};if(t.isValid())t.field.removeClass("error");else{r++;t.field.addClass("error")}n={};n.month={};n.month.field=e("[name='cc_expir_month']");n.month.val=n.month.field.val();n.month.regEx=/^(01|02|03|04|05|06|07|08|09|10|11|12)$/;n.month.isValid=function(){return n.month.regEx.test(n.month.val)?!0:!1};if(n.month.isValid())n.month.field.removeClass("error");else{r++;n.month.field.addClass("error")}n.year={};n.year.field=e("[name='cc_expir_year']");n.year.val=parseInt(n.year.field.val(),10);n.year.isValid=function(){return isNaN(n.year.val)?!1:n.year.val>=2013?!0:!1};if(n.year.isValid())n.year.field.removeClass("error");else{n.year.field.addClass("error");r++}if(r>0){e(".sequential_error_message").text("Please correct the problems marked above.");e("body").addClass("sequential_error");return!1}o.bodyNode.removeClass("sequential_error");e(".sequential_error_message").text("");return!0};var r={stepContainers:e(".sequential_step"),donationAmountLimit:null,donationAmountMinimum:null,validationFunctions:[o.utilityFunctions.validateAmounts,o.utilityFunctions.validatePersonalInfo,o.utilityFunctions.validatePaymentInfo]};o.settings=e.extend(!0,r,t);o.bodyNode.addClass("sequential").addClass("sequential_step_"+o.currentStep);o.settings.requireCountry&&o.bodyNode.addClass("sequential_country_field");e(o.settings.stepContainers[0]).addClass("active");e("li.sequential_breadcrumb_0").addClass("active");e(o.settings.stepContainers).not(e(o.settings.stepContainers[o.currentStep])).addClass("inactive");e(".sequential_move_forward").each(function(){e(this).click(function(t){if(typeof o.settings.validationFunctions[o.currentStep]=="function"){var n=o.settings.validationFunctions[o.currentStep]();if(n)if(o.currentStep===o.settings.stepContainers.length-1){s.submitForm();e("#sequential_donate_btn_copy").text("Processing...")}else o.utilityFunctions.goToStep(o.currentStep+1)}t.preventDefault()})});e("#sequential_breadcrumb").delegate("a","click",function(t){var n=e(t.currentTarget.offsetParent);t.preventDefault();n.hasClass("sequential_breadcrumb_amount")?o.utilityFunctions.goToStep(0):n.hasClass("sequential_breadcrumb_name")?o.utilityFunctions.goToStep(1):n.hasClass("sequential_breadcrumb_payment")&&o.utilityFunctions.goToStep(2)})}})})(jQuery);window.sequential=o;(function(e){function m(e){var t=a.val(),n=f.hide().find("#state_cd");if(t==="US"){if(!n.is("select")){n.remove();f.append(p.val(""))}r.removeClass("state-text-input");l.text("*State");h.text("*ZIP");v="US"}else{if(n.is("select")){n.remove();f.append(d.val(""))}r.addClass("state-text-input");l.text(t==="GB"?"*County":"*State/Region/Province");h.text("*Postal Code");v=t==="GB"?"GB":"INT"}f.show()}var t=e("body"),r=t.find("form"),i=t.find(".preset_amount_label"),s=t.find(".preset_amount_input"),o=t.find("#amount_other"),u=t.find("#other_amount_radio"),a=t.find("#country"),f=t.find("#state_cd_cont"),l=f.find("label.state_cd_related"),c=f.find("#state_cd"),h=r.find("label.zip_related"),p=t.find(".us-state-dropdown").eq(0).clone().val("").addClass("state_cd").removeClass("hidden").attr("name","state_cd").attr("id","state_cd"),d=e("<input/>",{type:"text",name:"state_cd",id:"state_cd","class":"text"}),v=r.data("default-country");e(".other_amount_label").hide();r.find('[name="http_referrer"]').val(document.referrer);n("nomin")==="true"&&e("<input/>",{type:"hidden",name:"nomin",value:"1"}).appendTo(r);e("#amounts").on("click",".preset_amount_label",function(t){var n=e(this);i.removeClass("active");n.addClass("active");o.val("");n.prev().prop("checked",!0)}).on("keydown","#amount_other",function(){i.removeClass("active");s.each(function(){e(this).attr("checked",!1)});u.prop("checked",!0)}).one("keydown","#amount_other",function(){t.removeClass("pre-first-click")}).one("click",".preset_amount_label",function(){t.removeClass("pre-first-click");e.Topic("first-click").publish()});a.on("change",function(){m()})})(jQuery)})(jQuery,window);